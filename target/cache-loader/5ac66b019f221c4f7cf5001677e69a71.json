{"remainingRequest":"c:\\jhipster\\cleanclient\\node_modules\\thread-loader\\dist\\cjs.js??ref--4-2!c:\\jhipster\\cleanclient\\node_modules\\ts-loader\\index.js??ref--4-3!c:\\jhipster\\cleanclient\\node_modules\\tslint-loader\\index.js!c:\\jhipster\\cleanclient\\src\\main\\webapp\\app\\modules\\upload\\upload.tsx","dependencies":[{"path":"c:\\jhipster\\cleanclient\\src\\main\\webapp\\app\\modules\\upload\\upload.tsx","mtime":1560782561986},{"path":"c:\\jhipster\\cleanclient\\node_modules\\react-hot-loader\\webpack.js","mtime":499162500000},{"path":"c:\\jhipster\\cleanclient\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"c:\\jhipster\\cleanclient\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"c:\\jhipster\\cleanclient\\node_modules\\ts-loader\\index.js","mtime":1545640398000},{"path":"c:\\jhipster\\cleanclient\\node_modules\\tslint-loader\\index.js","mtime":1519899048000}],"contextDependencies":[],"result":["import './upload.scss';\r\nimport { createEntity, getEntity } from 'app/entities/import-fichier/import-fichier.reducer';\r\nimport React from 'react';\r\nimport { Translate } from 'react-jhipster';\r\nimport XLSX from 'xlsx';\r\nimport { connect } from 'react-redux';\r\nimport { Row, Col, Alert, Input, Button } from 'reactstrap';\r\nimport { getSession } from 'app/shared/reducers/authentication';\r\nimport ReactTable from 'react-table';\r\n// tslint:disable-next-line\r\nimport 'react-table/react-table.css';\r\nimport { UploadModalSheet } from './upload-modal-sheet';\r\nimport { UploadModelDownload } from './upload-model-download';\r\nimport { UploadStructureControl } from './upload-structure-control';\r\nimport moment from 'moment';\r\nexport class Upload extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this._handleFileInputChange = evt => {\r\n            const f = evt.target.files[0];\r\n            this.setState({ filename: f.name });\r\n            const reader = new FileReader();\r\n            reader.onload = evt2 => {\r\n                const fr = evt2.target;\r\n                // tslint:disable-next-line\r\n                const bstr = fr.result;\r\n                const wb = XLSX.read(bstr, { type: 'binary' });\r\n                this.setState({ excelWorkbook: wb });\r\n            };\r\n            reader.readAsBinaryString(f);\r\n        };\r\n        this._clickFileInput = evt => {\r\n            const fileUpload = document.getElementById('fileUploadButton');\r\n            fileUpload.click();\r\n        };\r\n        this._chooseSheet = sheetName => {\r\n            const wb = this.state.excelWorkbook;\r\n            const sheetIndex = wb.SheetNames.findIndex(item => item === sheetName);\r\n            if (sheetIndex !== -1) {\r\n                const wsname = wb.SheetNames[sheetIndex];\r\n                const ws = wb.Sheets[wsname];\r\n                /* Convert array of arrays */\r\n                const data = XLSX.utils.sheet_to_json(ws, { defval: '' });\r\n                /* Update state */\r\n                if (data.length > 0) {\r\n                    this.setState({ rows: data });\r\n                    const columns = Object.keys(data[0]).map((key, id) => {\r\n                        return {\r\n                            Header: key,\r\n                            accessor: key\r\n                        };\r\n                    });\r\n                    // tslint:disable-next-line\r\n                    this.setState({ columns: columns });\r\n                }\r\n                this._cancelModal();\r\n            }\r\n            else {\r\n            }\r\n        };\r\n        this._cancelModal = () => {\r\n            moment.now;\r\n            this.setState({ excelWorkbook: {} });\r\n        };\r\n        this._downloadUploadModel = () => { };\r\n        this._sayFileOk = isFileOk => {\r\n            this.setState({ isFileOk: isFileOk });\r\n        };\r\n        this.saveEntity = () => {\r\n            const { rows } = this.state;\r\n            let importLigneArray = [];\r\n            rows.forEach(element => {\r\n                const row = {\r\n                    nom: element.nom,\r\n                    adresse: element.adresse,\r\n                    cp: element.codepostal,\r\n                    ville: element.ville,\r\n                    siret: element.siret\r\n                };\r\n                importLigneArray.push(row);\r\n            });\r\n            const entity = {\r\n                dateDeDebut: moment(),\r\n                importLignes: importLigneArray\r\n            };\r\n            this.props.createEntity(entity);\r\n        };\r\n        this.getFichierCree = () => {\r\n            const entity = {};\r\n            this.props.getEntity(entity.id);\r\n            return entity;\r\n        };\r\n        this.state = {\r\n            rows: [],\r\n            columns: [],\r\n            filename: '',\r\n            excelSheets: [],\r\n            excelWorkbook: {},\r\n            excelSheetsChosen: '',\r\n            isFileOk: false,\r\n        };\r\n    }\r\n    componentDidMount() {\r\n        this.props.getSession();\r\n        document.title = 'Importez vos données clients';\r\n    }\r\n    componentWillUpdate(nextProps) {\r\n        if (nextProps.updateSuccess !== this.props.updateSuccess && nextProps.updateSuccess) {\r\n            this.props.history.push('/entity/import-fichier/' + this.props.importFichierEntity.id);\r\n        }\r\n    }\r\n    render() {\r\n        const { rows } = this.state;\r\n        const { columns } = this.state;\r\n        return (React.createElement(\"div\", null,\r\n            React.createElement(Row, null,\r\n                React.createElement(Col, { md: \"12\" },\r\n                    React.createElement(\"h2\", { className: \"text-center\" },\r\n                        React.createElement(Translate, { contentKey: \"upload.title\" }, \"Import your B to B Customers excel file\"))),\r\n                React.createElement(Col, { md: { size: 6, offset: 3 } },\r\n                    React.createElement(Alert, { color: \"warning\" },\r\n                        React.createElement(Translate, { contentKey: \"upload.warning\" }, \"Import your B to B Customers excel file\"),\r\n                        React.createElement(UploadModelDownload, null))),\r\n                React.createElement(Col, { md: { size: 6, offset: 3 } },\r\n                    React.createElement(Alert, { color: \"success\" },\r\n                        React.createElement(Translate, { contentKey: \"upload.advice\" }, \"Import your B to B Customers excel file\")))),\r\n            React.createElement(Row, { className: \"text-center\" },\r\n                React.createElement(Col, null,\r\n                    React.createElement(Input, { type: \"file\", name: \"fileUploadButton\", id: \"fileUploadButton\", placeholder: \"with a placeholder\", onChange: this._handleFileInputChange, \r\n                        // tslint:disable-next-line\r\n                        onClick: event => {\r\n                            event.target.value = null;\r\n                        } }),\r\n                    React.createElement(Button, { color: \"primary\", onClick: this._clickFileInput }, rows.length === 0 ? (React.createElement(Translate, { contentKey: \"upload.buttonLabel\" }, \"Import your B to B Customers excel file\")) : (React.createElement(Translate, { contentKey: \"upload.buttonModifyLabel\" }, \"Import your B to B Customers excel file\"))),\r\n                    React.createElement(UploadModalSheet, { cancelModal: this._cancelModal, excelWorkbook: this.state.excelWorkbook, chooseSheet: this._chooseSheet }))),\r\n            rows.length > 0 && (React.createElement(Row, { className: \"upload-preview\" },\r\n                React.createElement(Col, { md: \"12\" },\r\n                    React.createElement(\"h2\", { className: \"text-center\" },\r\n                        React.createElement(Translate, { contentKey: \"upload.preview\" }, \"Preview\"),\r\n                        this.state.filename)),\r\n                React.createElement(Col, { md: { size: 4, offset: 4 } }, this.state.isFileOk && (React.createElement(Alert, { className: \"clearfix\", color: \"success\" },\r\n                    React.createElement(Translate, { contentKey: \"upload.file-is-ok\" }, \"Import your B to B Customers excel file\"),\r\n                    React.createElement(Button, { color: \"success\", className: \"float-right\", onClick: this.saveEntity },\r\n                        React.createElement(Translate, { contentKey: \"upload.launch\" }, \"Launch\"))))),\r\n                React.createElement(Col, { md: { size: 6, offset: 3 } },\r\n                    React.createElement(UploadStructureControl, { columns: columns.map(item => item.accessor), sayFileOk: this._sayFileOk, isFileOk: this.state.isFileOk })),\r\n                React.createElement(Col, { md: \"12\" },\r\n                    React.createElement(ReactTable, { showPagination: false, data: rows, columns: columns, style: {\r\n                            height: Math.min(40 + rows.length * 40, 400) + 'px'\r\n                        }, pageSize: rows.length }))))));\r\n    }\r\n}\r\nconst mapStateToProps = storeState => ({\r\n    account: storeState.authentication.account,\r\n    isAuthenticated: storeState.authentication.isAuthenticated,\r\n    importFichierEntity: storeState.importFichier.entity,\r\n    updateSuccess: storeState.importFichier.updateSuccess\r\n});\r\nconst mapDispatchToProps = { getSession, createEntity, getEntity };\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Upload);\r\n",{"version":3,"file":"c:\\jhipster\\cleanclient\\src\\main\\webapp\\app\\modules\\upload\\upload.tsx","sourceRoot":"","sources":["c:\\jhipster\\cleanclient\\node_modules\\tslint-loader\\index.js!c:\\jhipster\\cleanclient\\src\\main\\webapp\\app\\modules\\upload\\upload.tsx"],"names":[],"mappings":"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","sourcesContent":["import './upload.scss';\r\nimport { IImportFichier } from 'app/shared/model/import-fichier.model';\r\nimport { IImportLigne } from 'app/shared/model/import-ligne.model';\r\nimport {createEntity, getEntity} from 'app/entities/import-fichier/import-fichier.reducer';\r\nimport React from 'react';\r\nimport { Link, RouteComponentProps } from 'react-router-dom';\r\nimport { Translate } from 'react-jhipster';\r\nimport XLSX from 'xlsx';\r\nimport { connect } from 'react-redux';\r\nimport { Row, Col, Alert, Form, FormGroup, Label, Input, Button } from 'reactstrap';\r\nimport { getSession } from 'app/shared/reducers/authentication';\r\nimport ReactTable from 'react-table';\r\n// tslint:disable-next-line\r\nimport 'react-table/react-table.css';\r\nimport { UploadModalSheet } from './upload-modal-sheet';\r\nimport { UploadModelDownload } from './upload-model-download';\r\nimport { UploadStructureControl } from './upload-structure-control';\r\nimport moment from 'moment';\r\n\r\nexport interface IUploadProp extends StateProps, DispatchProps, RouteComponentProps<{ id: string }> {}\r\n\r\nexport interface IUploadState {\r\n  rows: any[];\r\n  columns: Array<{ Header: string; accessor: string }>;\r\n  filename: '';\r\n  excelSheets: String[];\r\n  excelWorkbook: any;\r\n  excelSheetsChosen: '';\r\n  isFileOk: boolean;\r\n}\r\n\r\nexport class Upload extends React.Component<IUploadProp, IUploadState> {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      rows: [],\r\n      columns: [],\r\n      filename: '',\r\n      excelSheets: [],\r\n      excelWorkbook: {},\r\n      excelSheetsChosen: '',\r\n      isFileOk: false,\r\n      \r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props.getSession();\r\n    document.title = 'Importez vos données clients';\r\n  }\r\n\r\n\r\n    componentWillUpdate(nextProps) {\r\n      if (nextProps.updateSuccess !== this.props.updateSuccess && nextProps.updateSuccess) {\r\n        this.props.history.push('/entity/import-fichier/'+this.props.importFichierEntity.id);\r\n      }\r\n    }\r\n    \r\n  \r\n\r\n  _handleFileInputChange = evt => {\r\n    const f = evt.target.files[0];\r\n\r\n    this.setState({ filename: f.name });\r\n\r\n    const reader = new FileReader();\r\n\r\n    reader.onload = evt2 => {\r\n      const fr = evt2.target as FileReader;\r\n      // tslint:disable-next-line\r\n      const bstr = fr.result;\r\n\r\n      const wb = XLSX.read(bstr, { type: 'binary' });\r\n      this.setState({ excelWorkbook: wb });\r\n    };\r\n    reader.readAsBinaryString(f);\r\n  };\r\n\r\n  _clickFileInput = evt => {\r\n    const fileUpload = document.getElementById('fileUploadButton');\r\n    fileUpload.click();\r\n  };\r\n\r\n  _chooseSheet = sheetName => {\r\n    const wb = this.state.excelWorkbook;\r\n    const sheetIndex = wb.SheetNames.findIndex(item => item === sheetName);\r\n    if (sheetIndex !== -1) {\r\n      const wsname = wb.SheetNames[sheetIndex];\r\n      const ws = wb.Sheets[wsname];\r\n\r\n      /* Convert array of arrays */\r\n      const data = XLSX.utils.sheet_to_json(ws, { defval: '' });\r\n      /* Update state */\r\n      if (data.length > 0) {\r\n        this.setState({ rows: data });\r\n        const columns = Object.keys(data[0]).map((key, id) => {\r\n          return {\r\n            Header: key,\r\n            accessor: key\r\n          };\r\n        });\r\n        // tslint:disable-next-line\r\n        this.setState({ columns: columns });\r\n      }\r\n      this._cancelModal();\r\n    } else {\r\n    }\r\n  };\r\n\r\n  _cancelModal = () => {\r\n    moment.now;\r\n    this.setState({ excelWorkbook: {} });\r\n  };\r\n\r\n  _downloadUploadModel = () => {};\r\n\r\n  _sayFileOk = isFileOk => {\r\n    this.setState({ isFileOk: isFileOk });\r\n  };\r\n\r\n  saveEntity = () => {\r\n    const { rows } = this.state \r\n    let importLigneArray:IImportLigne[] = [];\r\n \r\n    rows.forEach( element => {\r\n      const row: IImportLigne = {\r\n        nom : element.nom,\r\n        adresse : element.adresse,\r\n        cp : element.codepostal,\r\n        ville : element.ville,\r\n        siret : element.siret\r\n      }\r\n      importLigneArray.push(row)\r\n    });\r\n \r\n    const entity : IImportFichier = {\r\n      dateDeDebut : moment(),\r\n      importLignes : importLigneArray\r\n    };\r\n \r\n    this.props.createEntity( entity );\r\n    };\r\n\r\n  getFichierCree = () => {\r\n    const entity : IImportFichier = { } \r\n\r\n    this.props.getEntity(entity.id);\r\n\r\n    return entity\r\n  }  \r\n\r\n  render() {\r\n    const { rows } = this.state;\r\n    const { columns } = this.state;\r\n    return (\r\n      <div>\r\n        <Row>\r\n          <Col md=\"12\">\r\n            <h2 className=\"text-center\">\r\n              <Translate contentKey=\"upload.title\">Import your B to B Customers excel file</Translate>\r\n            </h2>\r\n          </Col>\r\n          <Col md={{ size: 6, offset: 3 }}>\r\n            <Alert color=\"warning\">\r\n              <Translate contentKey=\"upload.warning\">Import your B to B Customers excel file</Translate>\r\n              <UploadModelDownload />\r\n            </Alert>\r\n          </Col>\r\n          <Col md={{ size: 6, offset: 3 }}>\r\n            <Alert color=\"success\">\r\n              <Translate contentKey=\"upload.advice\">Import your B to B Customers excel file</Translate>\r\n            </Alert>\r\n          </Col>\r\n        </Row>\r\n        <Row className=\"text-center\">\r\n          <Col>\r\n            <Input\r\n              type=\"file\"\r\n              name=\"fileUploadButton\"\r\n              id=\"fileUploadButton\"\r\n              placeholder=\"with a placeholder\"\r\n              onChange={this._handleFileInputChange}\r\n              // tslint:disable-next-line\r\n              onClick={event => {\r\n                event.target.value = null;\r\n              }}\r\n            />\r\n            <Button color=\"primary\" onClick={this._clickFileInput}>\r\n              {rows.length === 0 ? (\r\n                <Translate contentKey=\"upload.buttonLabel\">Import your B to B Customers excel file</Translate>\r\n              ) : (\r\n                <Translate contentKey=\"upload.buttonModifyLabel\">Import your B to B Customers excel file</Translate>\r\n              )}\r\n            </Button>\r\n            <UploadModalSheet cancelModal={this._cancelModal} excelWorkbook={this.state.excelWorkbook} chooseSheet={this._chooseSheet} />\r\n          </Col>\r\n        </Row>\r\n        {rows.length > 0 && (\r\n          <Row className=\"upload-preview\">\r\n            <Col md=\"12\">\r\n              <h2 className=\"text-center\">\r\n                <Translate contentKey=\"upload.preview\">Preview</Translate>\r\n                {this.state.filename}\r\n              </h2>\r\n            </Col>\r\n            <Col md={{ size: 4, offset: 4 }}>\r\n              {this.state.isFileOk && (\r\n                <Alert className=\"clearfix\" color=\"success\">\r\n                <Translate contentKey=\"upload.file-is-ok\">Import your B to B Customers excel file</Translate>\r\n                <Button color=\"success\" \r\n                        className=\"float-right\" \r\n                        onClick={this.saveEntity}\r\n                        ><Translate contentKey=\"upload.launch\">Launch</Translate>\r\n                </Button>\r\n                </Alert>\r\n                \r\n              )}\r\n            </Col>\r\n            <Col md={{ size: 6, offset: 3 }}>\r\n              <UploadStructureControl\r\n                columns={columns.map(item => item.accessor)}\r\n                sayFileOk={this._sayFileOk}\r\n                isFileOk={this.state.isFileOk}\r\n              />\r\n            </Col>\r\n            <Col md=\"12\">\r\n              <ReactTable\r\n                showPagination={false}\r\n                data={rows}\r\n                columns={columns}\r\n                style={{\r\n                  height: Math.min(40 + rows.length * 40, 400) + 'px'\r\n                }}\r\n                pageSize={rows.length}\r\n              />\r\n            </Col>\r\n          </Row>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = storeState => ({\r\n  account: storeState.authentication.account,\r\n  isAuthenticated: storeState.authentication.isAuthenticated,\r\n  importFichierEntity: storeState.importFichier.entity,\r\n  updateSuccess: storeState.importFichier.updateSuccess\r\n});\r\n\r\nconst mapDispatchToProps = { getSession, createEntity, getEntity };\r\n\r\ntype StateProps = ReturnType<typeof mapStateToProps>;\r\ntype DispatchProps = typeof mapDispatchToProps;\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(Upload);\r\n"]}]}